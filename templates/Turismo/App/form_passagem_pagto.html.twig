{% extends 'Turismo/App/form_passagem_base.html.twig' %}

{% block up_scripts %}
    <script src="https://assets.pagar.me/checkout/1.1.0/checkout.js"></script>
{% endblock %}

{% block conteudo %}

{% endblock %}

{% block down_scripts %}

    {% set compra = app.session.get('compra') %}
    {% set totais = compra.getTotais() %}

    <script>

        $(document).ready(function () {

            // inicia a inst√¢ncia do checkout
            var checkout = new PagarMeCheckout.Checkout({
                encryption_key: 'ek_test_PRZKk0lxBz2qE7boo7T1kqZnzdkKrL',
                success: function (data) {
                    window.location = '/app/tur/compra/pagto?result=OK&token=' + data.token + '&payment_method=' + data.payment_method
                },
                error: function (err) {
                    $.get('/app/tur/compra/pagto?result=ERR&msg=' + err?.message + '&type=' + err?.type);
                },
                close: function () {
                    window.location = '/app/tur/compra/resumo'
                }
            });

            checkout.open({
                amount: {{ totais.geral|number_format(2,'','') }},
                postbackUrl: '{{ postbackUrl }}',
                customerData: 'true',
                paymentMethods: 'credit_card',
                createToken: 'true',
                items: [{
                    id: '1',
                    title: 'VIACAO IAPO PASSAGENS',
                    unit_price: {{ totais.geral|number_format(2,'','') }},
                    quantity: 1,
                    tangible: 'false',
                }]
            });
        });
    </script>

{% endblock %}
